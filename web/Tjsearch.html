<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">

    <title>统计查询</title>

    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>

</head>
<script>
    var number=1;
    function search() {
        var tjzd = $("#Tjzd").find("option:selected").text();
        var tx = $("#Tx").find("option:selected").text();
        $.ajax({
            url:"../Tj_search",
            type : "post",//请求方式
            data:{"tjzd":tjzd},
            datatype : "JSON",//
            success:function (data) {
                if(tjzd=="机构属性") {
                    data = JSON.parse(data);
                    if(tx=="饼状图") {
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>机构属性</th><th>个数</th></tr></thead><tbody>";

                        var Data = [];
                        for(i=0;i<data.length;i++){
                            var str = new Object();
                            str.name = data[i].jgsx;
                            str.value = data[i].counts;

                            Data.push(str);

                            text+="<tr>";
                            text+="<td>"+data[i].jgsx+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响接下来的表样式
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            series : [
                                {
                                    name: '访问来源',
                                    type: 'pie',
                                    radius: '55%',
                                    data:Data
                                }
                            ]
                        };
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                    else if(tx=="折线图"){
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>机构属性</th><th>个数</th></tr></thead><tbody>";
                        var keys = [];
                        var values = [];
                        for (i = 0; i < data.length; i++) {
                            keys.push(data[i].jgsx);
                            values.push(data[i].counts);

                            text+="<tr>";
                            text+="<td>"+data[i].jgsx+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";

                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响接下来的表样式
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        option = {
                            xAxis: {
                                type: 'category',
                                data: keys
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                data: values,
                                type: 'line'
                            }]
                        };
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                    else{
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>机构属性</th><th>个数</th></tr></thead><tbody>";
                        var keys = [];
                        var values = [];
                        for (i = 0; i < data.length; i++) {
                            keys.push(data[i].jgsx);
                            values.push(data[i].counts);

                            text+="<tr>";
                            text+="<td>"+data[i].jgsx+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";

                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响接下来的表样式
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            title: {
                                text: '机构属性统计'
                            },
                            color: ['#3398DB'],
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                }
                            },

                            legend: {
                                data: ['次数']
                            },
                            xAxis: {
                                data: keys
                            },
                            yAxis: {
                                minInterval: 1
                            },
                            series: [{
                                name: '数量',
                                type: 'bar',
                                data: values
                            }]
                        };

                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                }
                else if(tjzd=="所在地域"){
                    data=JSON.parse(data);
                    if(tx=="饼状图") {

                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>所在地域</th><th>个数</th></tr></thead><tbody>";

                        var Data = [];
                        for(i=0;i<data.length;i++){
                           var str = new Object();
                           str.name = data[i].szdy;
                           str.value = data[i].counts;
                           Data.push(str);

                            text+="<tr>";
                            text+="<td>"+data[i].szdy+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            series : [
                                {
                                    name: '所在地域',
                                    type: 'pie',
                                    radius: '55%',
                                    data:Data
                                }
                            ]
                        };
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                    else if(tx=="折线图"){
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>所在地域</th><th>个数</th></tr></thead><tbody>";
                        var keys = [];
                        var values = [];
                        for (i = 0; i < data.length; i++) {
                            keys.push(data[i].szdy);
                            values.push(data[i].counts);

                            text+="<tr>";
                            text+="<td>"+data[i].szdy+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        option = {
                            xAxis: {
                                type: 'category',
                                data: keys
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                data: values,
                                type: 'line'
                            }]
                        };
                        myChart.setOption(option);

                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                    else{
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>所在地域</th><th>个数</th></tr></thead><tbody>";
                        var keys = [];
                        var values = [];
                        for (i = 0; i < data.length; i++) {
                            keys.push(data[i].szdy);
                            values.push(data[i].counts);

                            text+="<tr>";
                            text+="<td>"+data[i].szdy+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响样式
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            title: {
                                text: '所在地域统计'
                            },
                            color: ['#3398DB'],
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                }
                            },

                            legend: {
                                data: ['次数']
                            },
                            xAxis: {
                                data: keys
                            },
                            yAxis: {
                                minInterval: 1
                            },
                            series: [{
                                name: '数量',
                                type: 'bar',
                                data: values
                            }]
                        };

                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                }
                else if(tjzd=="科技活动类型"){
                    data=JSON.parse(data);
                    if(tx=="饼状图") {
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>科技活动类型</th><th>个数</th></tr></thead><tbody>";
                        var Data = [];
                        for(i=0;i<data.length;i++){
                            var str = new Object();
                            str.name = data[i].yjlx;
                            str.value = data[i].counts;
                            Data.push(str);

                            text+="<tr>";
                            text+="<td>"+data[i].yjlx+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响样式
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            series : [
                                {
                                    name: '研究类型',
                                    type: 'pie',
                                    radius: '55%',
                                    data:Data
                                }
                            ]
                        };
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                    else if(tx=="折线图"){
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>科技活动类型</th><th>个数</th></tr></thead><tbody>";
                        var keys = [];
                        var values = [];
                        for (i = 0; i < data.length; i++) {
                            keys.push(data[i].yjlx);
                            values.push(data[i].counts);

                            text+="<tr>";
                            text+="<td>"+data[i].yjlx+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响样式

                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        option = {
                            xAxis: {
                                type: 'category',
                                data: keys
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                data: values,
                                type: 'line'
                            }]
                        };
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }
                    else{
                        var text = "<table id='table' class=\"table table-striped\"><thead><tr><th>科技活动类型</th><th>个数</th></tr></thead><tbody>";
                        var keys = [];
                        var values = [];
                        for (i = 0; i < data.length; i++) {
                            keys.push(data[i].yjlx);
                            values.push(data[i].counts);

                            text+="<tr>";
                            text+="<td>"+data[i].yjlx+"</td>" +
                                "<td>"+data[i].counts+"</td>" ;
                            text+="</tr>";
                        }
                        text+="</tbody></table>";
                        $("#show").html(text);
                        // 基于准备好的dom，初始化echarts实例
                        $("#main").attr("hidden",false);
                        echarts.init(document.getElementById('main')).dispose();//销毁上一个实例，否则会影响样式
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            title: {
                                text: '科技活动统计'
                            },
                            color: ['#3398DB'],
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                }
                            },

                            legend: {
                                data: ['次数']
                            },
                            xAxis: {
                                data: keys
                            },
                            yAxis: {
                                minInterval: 1
                            },
                            series: [{
                                name: '数量',
                                type: 'bar',
                                data: values
                            }]
                        };

                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                        myChart.on('click',function (params) {
                            // 获取table下所有的tr
                            let trs = $("#table tbody tr");
                            for (let i = 0;i<trs.length;i++){
                                // 获取tr下所有的td
                                let tds = trs.eq(i).find("td");
                                // 先把之前的标记的success去掉
                                $("#table tbody tr").eq(i).removeClass('success');
                                // 如果点击图示的名字和table下的某一个行的第一个td的值一样
                                if (params.name == tds.eq(0).text()){
                                    //设置success状态
                                    $("#table tbody tr").eq(i).addClass('success');
                                    // 跳转到页面指定的id位置
                                    $("html,body").animate({scrollTop:$("#table tbody tr").eq(i).offset().top},1000);
                                }
                            }
                        });
                        // 当鼠标落在tr时，显示浮动
                        $("#table tbody").find("tr").on("mouseenter",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'highlight',seriesIndex: 0, name:name});//选中高亮
                            myChart.dispatchAction({ type: 'showTip',seriesIndex: 0, name:name});//选中高亮
                        });
                        // 当鼠标移开tr时候取消浮动
                        $("#table tbody").find("tr").on("mouseleave",function () {
                            // 获得当前匹配元素的个数
                            let row = $(this).prevAll().length;
                            // 获得当前tr下td的名字
                            let name = $("#table tbody").find("tr").eq(row).find("td").eq(0).text();
                            // 设置浮动
                            myChart.dispatchAction({ type: 'downplay', name:name});//选中高亮
                            myChart.dispatchAction({ type: 'hideTip',seriesIndex: 0, name:name});//选中高亮
                        });
                    }

                }

            },
            error:function (e) {
                alert("获取表失败了！！！");
            }
        })
    }
    $(function () {
        $("#add").click(function () {
            if(number<5){
                number=number+1;
                $("#"+number).attr("hidden",false);
            }else {
                alert("最多添加4个检索条件！");
            }

        })
        $("#cut").click(function () {
            if(number>1){
                $("#"+number).attr("hidden","hidden");
                number=number-1;
            }else{
                alert("至少保留一个条件！！");
            }

        })
    })
    function jiansuo() {
        var lj="0";
        var jsc=$("#jsc_1").val();
        var value=$("#value_1").val();
        var lx=$("#lx_1").val();
        for(let i=1; i<number; i++){
            var j=i+1;
            lj+=","+$("#lj_"+j).val();
            jsc+=","+$("#jsc_"+j).val();
            value+=","+$("#value_"+j).val();
            lx+=","+$("#lx_"+j).val();
        }
        $.ajax({
            url:"../general_inquiry",
            type : "post",//请求方式
            data:{"lj":lj,"jsc":jsc,"value":value,"lx":lx},
            datatype : "json",
            async : false,//是否异步请求
            success:function (data) {
                data=JSON.parse(data);
                var text = "<table class=\"table table-striped\"><thead><tr><th>编号</th><th>机构名称</th><th>通讯地址</th><th>联系人</th><th>审核状态</th></tr></thead>";
                for (i=0;i<data.length;i++) {
                    var status = "未知状态";
                    if(data[i].status==1)
                        status = "形式审核通过";
                    else if(data[i].status==2)
                        status = "形式审核未通过";
                    else if(data[i].status==3)
                        status = "部门审核通过";
                    else if(data[i].status==4)
                        status = "部门审核未通过";
                    else if(data[i].status==0){
                        status="未进行审核";
                    }
                    text+="<tr>";
                    text+="<td>"+data[i].code+"</td>" +
                        "<td>"+data[i].jgmc+"</td>" +
                        "<td>"+data[i].txdz+"</td>" +
                        "<td>"+data[i].lxr+"</td>" +
                        "<td>"+status+"</td>";
                    text+="</tr>";
                }
                text+="</table>";
                alert("成功获取数据！！");
                $("#show").html(text);
                $("#main").attr("hidden","hidden");
            },
            error:function (e) {
                alert("综合查询失败!!");
            }
        })
    }
</script>
<body>
<div align="center">
     <h2>统计查询</h2>
     <HR  width="80%"color=#987cb9 SIZE=3>
</div>
<div align="center" >
    请选择统计字段:
    <select   style="width:210px;" id="Tjzd">
        <option value="" selected disabled>---请选择统计字段---</option>
        <option value="">机构属性</option>
        <option value="">所在地域</option>
        <option value="">科技活动类型</option>
        <option value="">管理处室</option>
    </select>
    选择图形:
    <select   style="width:100px;" id="Tx">
        <option value="" selected disabled>---请选择图形---</option>
        <option value="">柱状图</option>
        <option value="">折线图</option>
        <option value="">饼状图</option>

    </select>
    <button class="btn btn-success" id = "search" onclick="search()">统计查询</button>
</div>
<div align="left"  style="padding-top:30px;width: 60%;margin: auto;" >

    <div id="1" >
        <div style="display: inline">
            <button class="btn btn-success" id="add" style="padding-top: 5px;height: 40px;">增加检索条件</button>
            <button class="btn btn-danger" id="cut" style="padding-top: 5px;height: 40px;">减少检索条件</button>
        </div>
        <div style="padding-left: 50px;display: inline" align="center">
            <select id="jsc_1" style="padding-top: 5px;height: 40px;border-radius: 5px;">
                <option value="jgmc">机构全称</option>
                <option value="glcs">归口管理单位</option>
                <option value="szdy">所在地域</option>
                <option value="frdb">法人代表</option>
                <option value="lxr">联系人</option>
            </select>
            <input id="value_1" type="text" style="padding-top: 5px;height: 40px;border-radius: 5px;" >
            <select id="lx_1" style="padding-top: 5px;height: 40px;border-radius: 5px;">
                <option value="notlike" >精确</option>
                <option value="like" >模糊</option>
            </select><br/>
        </div>

    </div>
    <div id="2" hidden style="padding-top: 10px;" align="center">
        <select id="lj_2"  style="padding-top: 5px;height: 40px;border-radius: 5px;">
                <option value="or" >或者</option>
                <option value="and">并且</option>
            </select>
        <select id="jsc_2" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="jgmc">机构全称</option>
            <option value="glcs">归口管理单位</option>
            <option value="szdy">所在地域</option>
            <option value="frdb">法人代表</option>
            <option value="lxr">联系人</option>
        </select>
        <input id="value_2" type="text" style="padding-top: 5px;height: 40px;border-radius: 5px;" >
        <select id="lx_2" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="notlike" >精确</option>
            <option value="like" >模糊</option>
        </select><br/>
    </div>
    <div id="3" hidden style="padding-top: 10px;" align="center">
        <select id="lj_3"  style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="or" >或者</option>
            <option value="and">并且</option>
        </select>
        <select id="jsc_3" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="jgmc">机构全称</option>
            <option value="glcs">归口管理单位</option>
            <option value="szdy">所在地域</option>
            <option value="frdb">法人代表</option>
            <option value="lxr">联系人</option>
        </select>
        <input id="value_3" type="text" style="padding-top: 5px;height: 40px;border-radius: 5px;" >
        <select id="lx_3" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="notlike" >精确</option>
            <option value="like" >模糊</option>
        </select><br/>
    </div >
    <div id="4" hidden style="padding-top: 10px" align="center">
        <select id="lj_4"  style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="or" >或者</option>
            <option value="and">并且</option>
        </select>
        <select id="jsc_4" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="jgmc">机构全称</option>
            <option value="glcs">归口管理单位</option>
            <option value="szdy">所在地域</option>
            <option value="frdb">法人代表</option>
            <option value="lxr">联系人</option>
        </select>
        <input id="value_4" type="text" style="padding-top: 5px;height: 40px;border-radius: 5px;" >
        <select id="lx_4" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="notlike" >精确</option>
            <option value="like" >模糊</option>
        </select><br/>
    </div>
    <div id="5" hidden style="padding-top: 10px" align="center">
        <select id="lj_5" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="or" >或者</option>
            <option value="and">并且</option>
        </select>
        <select id="jsc_5" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="jgmc">机构全称</option>
            <option value="glcs">归口管理单位</option>
            <option value="szdy">所在地域</option>
            <option value="frdb">法人代表</option>
            <option value="lxr">联系人</option>
        </select>
        <input id="value_5" type="text" style="padding-top: 5px;height: 40px;border-radius: 5px;" >
        <select id="lx_5" style="padding-top: 5px;height: 40px;border-radius: 5px;">
            <option value="=" >精确</option>
            <option value="like" >模糊</option>
        </select><br/>
    </div>
    <div align="center" style="padding-top: 10px;" align="center">
        <button   class="btn btn-success" id = "jiansuo" onclick="jiansuo()">检索</button>
    </div>

</div>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div id="main" style="width: 600px;height:400px;margin: auto " align="center"></div>
<div id="show" >

</div>
</body>
</html>